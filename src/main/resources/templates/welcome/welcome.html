<!DOCTYPE html>
<!--suppress ThymeleafVariablesResolveInspection -->
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org" lang="zh">
<head>
	<meta charset="UTF-8">
	<title>一卡通</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
	<link rel="stylesheet" href="/x-admin/css/font.css">
	<link rel="stylesheet" href="/x-admin/css/xadmin.css">
	<link rel="stylesheet" href="/x-admin/lib/layui/css/modules/layer/default/layer.css">
</head>
<body>
<div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
	            <!--<a href="">演示</a>-->
                <a>
                    <cite>部门营业统计</cite>
                </a>
            </span>
	<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
		<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
	</a>
</div>
<div class="layui-fluid">
	<div class="layui-row layui-col-space15">
		<div class="layui-col-md12" style="display:none">
			<div class="layui-card">
				<div class="layui-card-body ">
					<blockquote class="layui-elem-quote">欢迎您
						<span class="x-red"></span>！
						当前时间:
						<span id="timeSpan" class="x-red"></span>
					</blockquote>
				</div>
			</div>
		</div>
		<!--数据统计-->
		<div class="layui-col-md12">
			<div class="layui-card">
				<!--<div class="layui-card-header">查询条件</div>-->
				<div class="layui-card-body ">
					<form class="layui-form layui-col-space5">
						<div class="layui-inline layui-show-xs-block">
							<label for="bgDate"></label>
							<input class="layui-input" autocomplete="off" placeholder="开始日" name="bgDate" id="bgDate" th:value="${bgDate}">
						</div>
						<div class="layui-inline layui-show-xs-block">
							<label for="edDate"></label>
							<input class="layui-input" autocomplete="off" placeholder="截止日" name="edDate" id="edDate" th:value="${edDate}">
						</div>
						<div class="layui-inline layui-show-xs-block" style="display:none">
							<label>
								<input type="text" size="30" name="deptName" placeholder="请输入想要查询的部门(可不填)" autocomplete="off" class="layui-input">
							</label>
						</div>
						<div class="layui-inline layui-show-xs-block">
							<button class="layui-btn" lay-submit="" lay-filter="sreach">
								<i class="layui-icon">&#xe615;查询</i>
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!--部门营业明细-->
		<div class="layui-col-md12">
			<div class="layui-card">
				<!--<div class="layui-card-header">澡堂营业日统计</div>-->
				<!--				<div class="layui-card-body">-->
				<!--					<table class="layui-hide" id="zaotang" lay-filter="zaotang"></table>-->
				<!--					<script type="text/html" id="zaotang_bar">-->
				<!--						<span class="layui-badge layui-bg-black">澡堂营业日统计</span>-->
				<!--					</script>-->
				<!--				</div>-->
				<!--				<div class="layui-card-body">-->
				<!--					<table class="layui-hide" id="shitang" lay-filter="shitang"></table>-->
				<!--					<script type="text/html" id="shitang_bar">-->
				<!--						<span class="layui-badge layui-bg-black">餐厅营业日统计</span>-->
				<!--					</script>-->
				<!--				</div>-->
				<div class="layui-card-body" th:each="info,infoStat : ${groupNameList}">
					<table class="layui-hide" th:id="${info.jianpin}" th:lay-filter="${info.jianpin}"></table>
					<!--					<script type="text/html" th:id="(${info.jianpin})+_bar">-->
					<!--						<span class="layui-badge layui-bg-black" th:text="(${info.groupname})+营业日统计"></span>-->
					<!--					</script>-->
				</div>
			</div>
		</div>
	</div>
</div>
<script src="/x-admin/js/jquery-3.2.1.min.js" type="text/javascript"></script>
<!--<script src="/x-admin/lib/jquery/jquery-1.12.4.min.js" type="text/javascript"></script>-->
<script src="/x-admin/lib/layui/layui.js"></script>
<script src="/x-admin/lib/layui/lay/modules/layer.js"></script>
<script src="/x-admin/lib/layui-ext-lib/excel.min.js"></script>
<script src="/x-admin/js/xadmin.js" type="text/javascript"></script>
<script src="/x-admin/js/date-formatter.js" type="text/javascript"></script>
<script type="text/javascript">
	layui.use('laydate',
		function(){
			const laydate = layui.laydate;
			//执行一个laydate实例
			laydate.render({
				//指定元素
				elem:'#bgDate',
				type:'datetime'
			});
			//执行一个laydate实例
			laydate.render({
				//指定元素
				elem:'#edDate',
				type:'datetime'
			});
		});
</script>
<script th:inline="javascript" type="text/javascript">
	$(function(){
		setInterval(function(){
			$('#timeSpan').text(getNowTime("yyyy-MM-dd HH:mm:ss"));
		},1000);
		// let data = [[${deptDayTurnoverJsonStr}]];
		// console.log(data);
		getData();
	});
</script>
<script th:inline="javascript">
	// function getData(){
	// 	renderZaoTangListData('澡堂','zaotang');
	// 	renderZaoTangListData('食堂','shitang');
	// }
	let dataDept = [[${groupNameList}]];
	function getData(){
		console.log(dataDept);
		for(let t in dataDept){
			console.log(dataDept[t].groupname+'  '+dataDept[t].jianpin);
			renderZaoTangListData(dataDept[t].groupname,dataDept[t].jianpin);
		}
	}
	function renderZaoTangListData(deptName,eleId){
		console.log(deptName+'  '+eleId);
		layui.use('table',function(){
			let bgDate = $('#bgDate').val();
			let edDate = $('#edDate').val();
			const table = layui.table;
			table.render({
				elem:'#'+eleId,
				url:'/welcomeListJson?bgDate='+bgDate+'&edDate='+edDate+'&deptName='+deptName,
				toolbar:'#'+eleId+'_bar',
				defaultToolbar:['filter','exports','print'],
				title:deptName+'营业日统计',
				parseData:function(e){
					return {
						"code":0,
						"msg":"",
						"count":e.length,
						"data":e,
					}
				},
				page:false,
				totalRow:true,
				cols:[
					[
						{field:'groupname',title:'部门',fixed:'left',sort:true,totalRowText:'合计'},
						{field:'ADate',title:'日期',sort:true},
						{field:'AmountAllDay',title:'金额(元￥)',sort:true,totalRow:true}
					]
				],
			});
		});
	}
</script>
</body>
</html>